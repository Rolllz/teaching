Занятие 1. Первые шаги с Ansible

Цель домашнего задания
Написать первые шаги с Ansible.

Описание домашнего задания
  Подготовить стенд на Vagrant как минимум с одним сервером. На этом сервере, используя Ansible необходимо развернуть nginx со следующими условиями:
- необходимо использовать модуль yum/apt
- конфигурационный файлы должны быть взяты из шаблона jinja2 с
переменными
- после установки nginx должен быть в режиме enabled в systemd
- должен быть использован notify для старта nginx после установки
- сайт должен слушать на нестандартном порту - 8080, для этого использовать переменные в Ansible
* Сделать все это с использованием Ansible роли

В данном ДЗ был использован Debian 12.
После установки и запуска ОС выполняются следующие команды:

#Находим в ssh-конфиге строчку с авторизованными ключами и раскомментируем

sudo sed -i 's/\#AuthorizedKeysFile/AuthorizedKeysFile/g' /etc/ssh/sshd_config

#Находим в ssh-конфиге строчку с подключением по публичному ключу и раскомментируем

sudo sed -i 's/\#PubkeyAuthentication yes/PubkeyAuthentication yes/g' /etc/ssh/sshd_config

#Перезапускаем службу для возможности подключения без пароля

sudo systemctl restart sshd

Описанные выше команды выполняются в Vagrantfile.

Далее в хостовой ОС выполняем следующие действия:

#Удаляем все записи с нашими параметрами, чтобы можно было подключиться без пароля

ssh-keygen -f ~/.ssh/known_hosts -R "[127.0.0.1]:2222"

#Копируем ключ на гостевую машину

ssh-copy-id -p 2222 vagrant@127.0.0.1

Сначала отвечаем yes, затем вводим пароль vagrant

После этого запускаем наш playbook:

ansible-playbook nginx.yml

После установки и настройки веб-сервера запускаем проверочную команду

curl 192.168.56.150:8080
